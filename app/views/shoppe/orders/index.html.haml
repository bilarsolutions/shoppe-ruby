- @page_title = 'Orders'

= content_for :header do
  %p.buttons= link_to "Search Orders", '#', :class => 'button', :rel => 'searchOrders'
  %h2.orders
    Orders
    %span= page_entries_info @orders
  
.orderSearch{:style => action_name == 'search' ? "display:block" : ''}
  = search_form_for @query, :url => search_orders_path, :html => { :method => :post } do |f|
    %dl.left
      %dt= f.label :id_eq, "Order Number"
      %dd= f.text_field :id_eq
      %dt= f.label :first_name_or_last_name_or_company_cont, "Customer"
      %dd= f.text_field :first_name_or_last_name_or_company_cont
      %dt= f.label :address1_or_address2_or_address3_or_address4_or_postcode_cont, "Address"
      %dd= f.text_field :address1_or_address2_or_address3_or_address4_or_postcode_cont
      %dt= f.label :consignment_number_cont, "Consignment Number"
      %dd= f.text_field :consignment_number_cont
      %dt= f.label :received_at_eq, "Received between"
      %dd
        = f.text_field :received_at_gteq, :class => 'small'
        &rarr;
        = f.text_field :received_at_lteq, :class => 'small'
    %dl.right
      %dt= f.label :products_name_cont, "Contains product"
      %dd= f.text_field :products_name_cont
      %dt= f.label :email_address_cont, "E-Mail Address"
      %dd= f.text_field :email_address_cont
      %dt= f.label :phone_number_cont, "Phone Number"
      %dd= f.text_field :phone_number_cont
      %dt= f.label :status_eq, "Status"
      %dd= f.select :status_eq, [nil] + Shoppe::Order::STATUSES.map { |s| [s.humanize, s]}
      %dd= f.submit "Search", :class => 'button green button'

.table
  %table.data
    %thead
      %tr
        %th Number
        %th Customer
        %th Status
        %th Products
        %th Total
        %th Paid?
    %tbody
      - if @orders.empty?
        %tr.empty
          %td{:colspan => 6} No orders to display.
      - else
        - for order in @orders
          %tr
            %td= link_to order.number, order
            %td= order.customer_name
            %td= status_tag order.status
            %td
              %ul
                - for item in order.order_items
                  %li #{item.quantity} x #{item.ordered_item.name}
            %td= number_to_currency order.total
            %td= boolean_tag order.paid?

= paginate @orders